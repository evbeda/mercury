{% extends 'base.html' %}
{% block content %}
<div class="container">
  
    {% if message %}
    <div class="alert alert-success">{{ message }}</div>
    {% endif %}
    <div id="fondo_sin_imagen" >
      <div class="container">
                    <h2>Merchandise</h2>

                               <div class="row">
    <div class="col-sm">
    </div>
    <div class="col-sm">
    </div>
    <div class="col-sm">
<input type=button class="btn btn-primary" value="Go Back" onClick="javascript:history.go(-1);">
    </div>
  </div>

        <form id="delivery" action="{% url 'item_mercha' order_id=order_id %}" method="POST">
<div class="card text-white bg-secondary mb-3">
  <div class="card-header">
    Order Details
  </div><div class="card-body">
                <h6 class="font-weight-light"><small>Name </small> {{ order.name }} </h6>
                <h6 class="font-weight-light"><small>Order# </small> {{ order.eb_order_id }} </h6>
                <h6 class="font-weight-light"><small>Date </small> {{ order.created }} </h6>
                </div>
                </div>
               {% for item in merchandising %}
               <br>
               <div class="card border-info mb-3">
  <div class="card-header bg-info text-white">
    {{ item.name }}
  </div><div class="card-body">
                <h4><small>Subtype</small> {{ item.item_type }} </h4>
                <h5><small>Sold</small> {{ item.quantity }} </h5>
                <h5><small>Unit value</small> {{ item.value }} </h5>
                <h5><small>Delivered</small> 
                {% if item.quantity == item.items_left %}
                <td>No</td>
                {% elif item.items_left == 0%}
                <td>Yes</td>
                {% else %}
                <td>Partially</td>
                {% endif %}
              </h5>
                <h5><small>Items left</small> {{ item.items_left }} </h5>

                <h5><small>Amount to deliver</small>
                  <script type="text/javascript">
                    var max_value = "{{ item.items_left }}";
                  </script>

              <input type=button value='-' class="btn btn-info btn-sm" id="minus{{ item.eb_merchandising_id }}"onclick='javascript:process(-1, "{{ item.eb_merchandising_id }}", {{ item.items_left }})'>
              <input readonly="readonly" type=text form="delivery" size="2" id='{{ item.eb_merchandising_id }}' name='{{ item.eb_merchandising_id }}' value='0'>
              <input type=button value='+' class="btn btn-info btn-sm" id="plus{{ item.eb_merchandising_id }}" onclick='javascript:process(1, "{{ item.eb_merchandising_id }}", {{ item.items_left }})'>
</h5>
                </div>
</div>

          {% endfor %}
            <div class="row">
    <div class="col-sm">
    </div>
    <div class="col-sm">
    </div>
    <div class="col-sm">
<button type="submit" form="delivery" class="btn btn-success" value="Submit">Mark as delivered</button></td>
    </div>
  </div>
            {% csrf_token %}

    </form>
</div>
</div>
</div>
</div>
<script language=javascript>
  function process(v, target, max){
    var value = parseInt(document.getElementById(target).value);
    if (max == 0){
      value = 0;
    }else if (value == 0) {
      if (v==1){
        value +=v;
      }else{
        value = value;
      }
    }else if (value == max && max != 0) {
      if (v==-1){
        value +=v;
      }else{

      }
    }else if (value < max) {
      value+=v;
    } else if (max == 0) {
      value = 0
    }
    document.getElementById(target).value = value;
  }
</script>


{% endblock %}
